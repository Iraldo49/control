<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de D√≠vidas - O que me Devem</title>
  <style>
         body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      width: 100%;
      display: flex;
      flex-direction: column;
      padding-bottom: 70px; /* Espa√ßo para o footer fixo */
    }

    * {
      box-sizing: border-box;
    }

    .app-container {
      width: 100%;
      flex: 1;
      background: #4a5568;
      padding: 1rem;
      padding-bottom: 80px; /* Adiciona espa√ßo para o footer fixo */
    }

    .content-wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding-bottom: 20px; /* Espa√ßo extra no final do conte√∫do */
    }

    .header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-top: 1rem;
    }

    .header h1 {
      color: #ffffff;
      font-size: 2rem;
      margin: 0 0 0.5rem 0;
      font-weight: 700;
    }

    .header p {
      color: rgba(255,255,255,0.8);
      margin: 0;
      font-size: 0.9rem;
    }

    /* Bot√£o Flutuante */
    .fab-button {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: white;
      border: none;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s;
    }

    .fab-button:hover {
      transform: scale(1.1);
    }

    /* Cards principais */
    .main-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .resumo-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .resumo-item {
      background: #f7fafc;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      border: 2px solid #e2e8f0;
    }

    .resumo-valor {
      font-size: 1.5rem;
      font-weight: 700;
      color: #667eea;
      margin: 0.5rem 0;
    }

    .resumo-label {
      font-size: 0.8rem;
      color: #718096;
      margin: 0;
      font-weight: 500;
    }

    .resumo-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    .badge-danger {
      background: #fed7d7;
      color: #c53030;
    }

    /* Lista de devedores */
    .lista-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .lista-header h2 {
      color: #2d3748;
      font-size: 1.25rem;
      margin: 0;
      font-weight: 600;
    }

    .notificacao-badge {
      background: #f56565;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      cursor: pointer;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .dividas-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .divida-item {
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.2s;
    }

    .divida-item:hover {
      border-color: #cbd5e0;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .divida-item.atrasada {
      background: #fff5f5;
      border-color: #fc8181;
      animation: pulse-border 1.5s infinite;
    }

    @keyframes pulse-border {
      0%, 100% { border-color: #fc8181; }
      50% { border-color: #fed7d7; }
    }

    .divida-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }

    .divida-nome {
      font-size: 1rem;
      font-weight: 600;
      color: #2d3748;
      margin: 0;
    }

    .divida-valor {
      font-size: 1.25rem;
      font-weight: 700;
      color: #667eea;
      margin: 0;
    }

    .divida-item.atrasada .divida-valor {
      color: #f56565;
    }

    .divida-info {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .divida-categoria {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .categoria-emprestimo { background: #bee3f8; color: #2c5282; }
    .categoria-servico { background: #fed7d7; color: #c53030; }
    .categoria-venda { background: #c6f6d5; color: #22543d; }
    .categoria-outro { background: #e9d8fd; color: #553c9a; }

    .divida-status {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-pendente { background: #fed7d7; color: #c53030; }
    .status-pago { background: #c6f6d5; color: #22543d; }
    .status-atrasada { 
      background: #fed7d7; 
      color: #c53030;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .divida-detalhes {
      color: #718096;
      font-size: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .divida-observacoes {
      color: #718096;
      font-size: 0.75rem;
      font-style: italic;
      margin: 0.25rem 0;
    }

    .divida-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .btn {
      padding: 0.5rem 0.75rem;
      border: none;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .btn-small {
      padding: 0.25rem 0.5rem;
      font-size: 0.7rem;
    }

    .btn-success {
      background: #48bb78;
      color: #ffffff;
    }

    .btn-success:hover:not(:disabled) {
      background: #38a169;
    }

    .btn-warning {
      background: #ed8936;
      color: #ffffff;
    }

    .btn-warning:hover:not(:disabled) {
      background: #dd6b20;
    }

    .btn-danger {
      background: #f56565;
      color: #ffffff;
    }

    .btn-danger:hover:not(:disabled) {
      background: #e53e3e;
    }

    .btn-edit {
      background: #4299e1;
      color: #ffffff;
    }

    .btn-edit:hover:not(:disabled) {
      background: #3182ce;
    }

    .btn-info {
      background: #4299e1;
      color: #ffffff;
    }

    .btn-info:hover:not(:disabled) {
      background: #3182ce;
    }

    /* Footer FIXO */
    .footer {
      background: #2d3748;
      color: #a0aec0;
      padding: 1rem;
      text-align: center;
      font-size: 0.8rem;
      position: fixed; /* Fixa na tela */
      bottom: 0; /* Cola na parte inferior */
      left: 0;
      width: 100%; /* Ocupa toda a largura */
      z-index: 99; /* Fica acima do conte√∫do */
    }

    .footer-content {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .footer-stats {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .footer-stat {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      animation: fadeIn 0.3s forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .modal-header h2 {
      margin: 0;
      color: #2d3748;
      font-size: 1.25rem;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #718096;
    }

    .modal-body {
      margin-bottom: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 1rem;
    }

    .form-group label {
      color: #4a5568;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 0.75rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.875rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      width: 100%;
      padding: 0.75rem;
      font-size: 0.875rem;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .toast {
      position: fixed;
      bottom: 120px; /* Ajustado para aparecer acima do footer fixo */
      right: 20px;
      background: #2d3748;
      color: #ffffff;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease-out;
      z-index: 1000;
      font-size: 0.875rem;
    }

    .toast.success {
      background: #48bb78;
    }

    .toast.warning {
      background: #ed8936;
    }

    .toast.danger {
      background: #f56565;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 2rem 1rem;
      color: #718096;
    }

    .empty-state-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 1rem;
      color: #4a5568;
      margin: 0 0 0.25rem 0;
    }

    .empty-state p {
      margin: 0;
      font-size: 0.75rem;
    }

    /* Bot√µes de filtro */
    #filtros button {
      background: #e2e8f0;
      color: #4a5568;
      border: none;
      padding: 0.4rem 0.75rem;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    #filtros button:hover {
      background: #cbd5e0;
    }

    @media (max-width: 768px) {
      .resumo-section {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .divida-actions {
        flex-direction: column;
      }
      
      .divida-actions button {
        width: 100%;
      }
      
      .footer-content {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
      }
      
      .footer-stats {
        justify-content: center;
      }
      
      .fab-button {
        bottom: 100px; /* Ajustado para n√£o sobrepor o footer */
        right: 15px;
        width: 50px;
        height: 50px;
        font-size: 20px;
      }
      
      /* Ajuste para mobile */
      body {
        padding-bottom: 100px; /* Mais espa√ßo para footer em mobile */
      }
      
      .app-container {
        padding-bottom: 100px;
      }
      
      .toast {
        bottom: 140px; /* Ajuste para mobile */
      }
    }

    @media (max-width: 480px) {
      .resumo-section {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      .main-card {
        padding: 1rem;
      }
      
      .footer {
        padding: 0.75rem;
      }
      
      .footer-stats {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
 </head>
 <body>
  <!-- O restante do HTML permanece igual -->
  <div class="app-container">
   <div class="content-wrapper">
    <header class="header">
     <h1>üí∞ D√≠vidas a Receber</h1>
     <p>Controle do que as pessoas devem no sabor da esquina</p>
    </header>

    <!-- Resumo Financeiro -->
    <div class="main-card">
      <div class="resumo-section" id="resumo-container">
        <!-- Ser√° preenchido pelo JavaScript -->
      </div>
    </div>

    <!-- Lista de Devedores -->
    <div class="main-card">
      <div class="lista-header">
        <h2>üìã Devedores</h2>
        <div id="notificacao-badge" class="notificacao-badge" style="display: none;" onclick="mostrarNotificacoes()">0</div>
      </div>
      
      <div id="filtros" style="margin-bottom: 1rem; display: flex; gap: 0.25rem; flex-wrap: wrap;">
        <button class="btn btn-small" onclick="filtrarDividas('todos')" style="background: #667eea; color: white;">Todos</button>
        <button class="btn btn-small" onclick="filtrarDividas('pendente')">Pendentes</button>
        <button class="btn btn-small" onclick="filtrarDividas('pago')">Recebidos</button>
        <button class="btn btn-small" onclick="filtrarDividas('atrasada')">Atrasadas</button>
      </div>
      
      <div id="dividas-container" class="dividas-list">
        <!-- Lista de d√≠vidas ser√° inserida aqui -->
      </div>
    </div>
   </div>
  </div>

  <!-- Bot√£o Flutuante para Adicionar D√≠vida -->
  <button class="fab-button" onclick="abrirModalAdicionar()">+</button>

  <!-- Footer FIXO -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-stats">
        <span class="footer-stat">üìä <span id="footer-total">MT 0,00</span></span>
        <span class="footer-stat">üë§ <span id="footer-devedores">0</span> devedores</span>
        <span class="footer-stat">‚è∞ <span id="footer-atrasadas">0</span> atrasadas</span>
      </div>
      <div>Desenvolvida pela Mutech ¬© 2025</div>
    </div>
  </footer>

  <!-- Modal para Adicionar/Editar D√≠vida COM TELEFONE -->
  <div id="modal-divida" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-titulo">‚ûï Adicionar Nova D√≠vida</h2>
        <button class="close-modal" onclick="fecharModal()">√ó</button>
      </div>
      <div class="modal-body">
        <form id="form-devedor">
          <div class="form-grid">
            <div class="form-group">
              <label for="input-nome">Nome do Devedor</label>
              <input type="text" id="input-nome" required placeholder="Ex: Maria Santos">
            </div>
            <div class="form-group">
              <label for="input-valor">Valor (mzn)</label>
              <input type="number" id="input-valor" step="0.01" min="0" required placeholder="0,00">
            </div>
          </div>
          
          <!-- NOVO CAMPO: Telefone para SMS -->
          <div class="form-group">
            <label for="input-telefone">N√∫mero de Celular (para SMS)</label>
            <input type="tel" id="input-telefone" placeholder="Ex: +258841234567 (opcional)">
            <p style="font-size: 0.75rem; color: #718096; margin-top: 0.25rem;">Formato: +258 seguido do n√∫mero</p>
          </div>
          
          <div class="form-group">
            <label for="input-categoria">Categoria</label>
            <select id="input-categoria" required>
                <option value="">Seleciona</option>
              <option value="emprestimo">üí∞ Empr√©stimo</option>
              <option value="servico">üîß Servi√ßo</option>
              <option value="venda">üõí Venda</option>
              <option value="outro">üìù Outro</option>
            </select>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="input-data">Data</label>
              <input type="date" id="input-data">
            </div>
            <div class="form-group">
              <label for="input-prazo">Prazo (dias)</label>
              <input type="number" id="input-prazo" min="1" placeholder="Opcional">
            </div>
          </div>
          
          <div class="form-group">
            <label for="input-observacoes">Detalhes</label>
            <textarea id="input-observacoes" placeholder="Ex: M-pesa, Batatas, Sumo etc."></textarea>
          </div>
          
          <button type="submit" class="btn btn-primary" id="btn-submit">
            <span id="btn-text-adicionar">‚ûï Adicionar D√≠vida</span>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Notifica√ß√µes -->
  <div id="modal-notificacoes" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üîî Cobran√ßas Pendentes</h2>
        <button class="close-modal" onclick="fecharModal()">√ó</button>
      </div>
      <div class="modal-body" id="modal-notificacoes-body">
        <!-- Conte√∫do das notifica√ß√µes ser√° inserido aqui -->
      </div>
    </div>
  </div>

  <!-- Modal de Cobran√ßa COM OP√á√ÉO DE SMS -->
  <div id="modal-cobranca" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-cobranca-titulo">üìß Enviar Cobran√ßa</h2>
        <button class="close-modal" onclick="fecharModal()">√ó</button>
      </div>
      <div class="modal-body" id="modal-cobranca-body">
        <!-- Conte√∫do da cobran√ßa ser√° inserido aqui -->
      </div>
    </div>
  </div>

  <!-- O JavaScript permanece exatamente igual ao c√≥digo anterior -->
  <script>
    // O JavaScript COMPLETO do c√≥digo anterior permanece aqui
    // (Todo o c√≥digo JavaScript que j√° estava funcionando)
    
    const STORAGE_KEY = 'dividas_a_receber';
    let dividas = [];
    let editingId = null;
    let filtroAtual = 'todos';

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
      carregarDividas();
      definirDataAtual();
      
      const form = document.getElementById('form-devedor');
      form.addEventListener('submit', handleSubmit);
    });

    // Fun√ß√µes principais
    function carregarDividas() {
      const dados = localStorage.getItem(STORAGE_KEY);
      dividas = dados ? JSON.parse(dados) : [];
      console.log('D√≠vidas carregadas:', dividas);
      atualizarInterface();
    }

    function salvarDividas() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(dividas));
      console.log('D√≠vidas salvas:', dividas);
      atualizarInterface();
    }

    function atualizarInterface() {
      atualizarResumo();
      atualizarListaDividas();
      atualizarFooter();
    }

    function atualizarResumo() {
      const totalPendente = dividas
        .filter(d => d.status === 'pendente')
        .reduce((sum, d) => sum + d.valor, 0);
      
      const totalRecebido = dividas
        .filter(d => d.status === 'pago')
        .reduce((sum, d) => sum + d.valor, 0);
      
      const devedoresPendentes = dividas.filter(d => d.status === 'pendente').length;
      const devedoresAtrasados = dividas.filter(d => d.atrasada).length;

      document.getElementById('resumo-container').innerHTML = `
        <div class="resumo-item">
          <p class="resumo-label">üí∞ A Receber</p>
          <p class="resumo-valor">MT ${totalPendente.toFixed(2).replace('.', ',')}</p>
          ${devedoresAtrasados > 0 ? `<span class="resumo-badge badge-danger">${devedoresAtrasados} atrasadas</span>` : ''}
        </div>
        <div class="resumo-item">
          <p class="resumo-label">‚úÖ Recebido</p>
          <p class="resumo-valor">MT ${totalRecebido.toFixed(2).replace('.', ',')}</p>
        </div>
        <div class="resumo-item">
          <p class="resumo-label">üë§ Devedores</p>
          <p class="resumo-valor">${devedoresPendentes}</p>
        </div>
      `;
    }

    function atualizarListaDividas() {
      const container = document.getElementById('dividas-container');
      
      // Filtrar d√≠vidas
      let dividasFiltradas = [...dividas];
      
      if (filtroAtual === 'pendente') {
        dividasFiltradas = dividasFiltradas.filter(d => d.status === 'pendente');
      } else if (filtroAtual === 'pago') {
        dividasFiltradas = dividasFiltradas.filter(d => d.status === 'pago');
      } else if (filtroAtual === 'atrasada') {
        dividasFiltradas = dividasFiltradas.filter(d => d.atrasada);
      }
      
      // Ordenar: atrasadas primeiro, depois pendentes, depois pagas
      dividasFiltradas.sort((a, b) => {
        if (a.atrasada && !b.atrasada) return -1;
        if (!a.atrasada && b.atrasada) return 1;
        if (a.status !== b.status) {
          return a.status === 'pendente' ? -1 : 1;
        }
        return new Date(b.criadoEm || 0) - new Date(a.criadoEm || 0);
      });

      if (dividasFiltradas.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üí∞</div>
            <h3>${filtroAtual !== 'todos' ? 'Nenhuma d√≠vida encontrada' : 'Nenhuma d√≠vida registrada'}</h3>
            <p>${filtroAtual !== 'todos' ? 'Tente mudar o filtro' : 'Clique no bot√£o "+" para adicionar'}</p>
          </div>
        `;
        return;
      }

      container.innerHTML = dividasFiltradas.map(divida => {
        const atrasadaClass = divida.atrasada ? 'atrasada' : '';
        let statusLabel = divida.status === 'pago' ? 'Recebido' : 'Pendente';
        let statusClass = divida.status === 'pago' ? 'status-pago' : 'status-pendente';
        
        if (divida.atrasada) {
          statusLabel = 'Atrasada';
          statusClass = 'status-atrasada';
        }

        // Calcular dias de atraso se houver prazo
        let diasInfo = '';
        if (divida.data && divida.prazo && divida.status !== 'pago') {
          const dataDivida = new Date(divida.data);
          const dataVencimento = new Date(dataDivida);
          dataVencimento.setDate(dataVencimento.getDate() + parseInt(divida.prazo));
          const agora = new Date();
          const diasAtraso = Math.floor((agora - dataVencimento) / (1000 * 60 * 60 * 24));
          
          if (diasAtraso > 0) {
            diasInfo = `<span style="color: #c53030;">‚è∞ ${diasAtraso} dia(s) atrasado</span>`;
          } else if (diasAtraso >= -3 && diasAtraso < 0) {
            diasInfo = `<span style="color: #ed8936;">‚ö†Ô∏è Vence em ${Math.abs(diasAtraso)} dia(s)</span>`;
          }
        }

        return `
          <div class="divida-item ${atrasadaClass}" data-id="${divida.id}">
            <div class="divida-header">
              <h3 class="divida-nome">${divida.nome}</h3>
              <p class="divida-valor">MT ${divida.valor.toFixed(2).replace('.', ',')}</p>
            </div>
            
            <div class="divida-info">
              <span class="divida-categoria categoria-${divida.categoria || 'outro'}">
                ${getNomeCategoria(divida.categoria)}
              </span>
              <span class="divida-status ${statusClass}">${statusLabel}</span>
            </div>
            
            <div class="divida-detalhes">
              ${divida.telefone ? `<span>üì± ${divida.telefone}</span> ‚Ä¢ ` : ''}
              ${divida.data ? `<span>üìÖ ${new Date(divida.data + 'T00:00:00').toLocaleDateString('pt-BR')}</span>` : ''}
              ${divida.prazo ? `<span> ‚Ä¢ ‚è±Ô∏è ${divida.prazo} dias</span>` : ''}
              ${diasInfo ? `<br>${diasInfo}` : ''}
              ${divida.observacoes ? `<p class="divida-observacoes">üí¨ ${divida.observacoes}</p>` : ''}
            </div>
            
            <div class="divida-actions">
              ${divida.status === 'pendente' ? 
                `<button class="btn btn-success" onclick="marcarComoRecebido('${divida.id}')">‚úÖ Recebido</button>` :
                `<button class="btn btn-warning" onclick="marcarComoPendente('${divida.id}')">‚Üª Pendente</button>`
              }
              <button class="btn btn-info" onclick="enviarCobranca('${divida.id}')">üìß Cobrar</button>
              <button class="btn btn-edit" onclick="editarDivida('${divida.id}')">‚úé Editar</button>
              <button class="btn btn-danger" onclick="removerDivida('${divida.id}')">‚úï</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function atualizarFooter() {
      const totalPendente = dividas
        .filter(d => d.status === 'pendente')
        .reduce((sum, d) => sum + d.valor, 0);
      
      const devedoresPendentes = dividas.filter(d => d.status === 'pendente').length;
      const devedoresAtrasados = dividas.filter(d => d.atrasada).length;

      document.getElementById('footer-total').textContent = `MT ${totalPendente.toFixed(2).replace('.', ',')}`;
      document.getElementById('footer-devedores').textContent = devedoresPendentes;
      document.getElementById('footer-atrasadas').textContent = devedoresAtrasados;
    }

    // Fun√ß√µes do formul√°rio
    async function handleSubmit(e) {
      e.preventDefault();

      const nome = document.getElementById('input-nome').value.trim();
      const valor = parseFloat(document.getElementById('input-valor').value);
      const telefone = document.getElementById('input-telefone').value.trim();
      const categoria = document.getElementById('input-categoria').value;
      const data = document.getElementById('input-data').value;
      const prazo = document.getElementById('input-prazo').value;
      const observacoes = document.getElementById('input-observacoes').value;

      if (!nome || isNaN(valor) || valor <= 0 || !categoria) {
        showToast("Preencha nome, valor e categoria v√°lidos!", 'warning');
        return;
      }

      const btnSubmit = document.getElementById('btn-submit');
      const btnText = document.getElementById('btn-text-adicionar');
      const originalText = btnText.textContent;

      btnSubmit.disabled = true;
      btnText.innerHTML = '<span class="loading-spinner"></span>';

      await new Promise(resolve => setTimeout(resolve, 300));

      try {
        if (editingId) {
          // Editar d√≠vida existente
          const divida = dividas.find(d => d.id === editingId);
          if (divida) {
            Object.assign(divida, {
              nome, valor, telefone, categoria, data, 
              prazo: prazo || null, observacoes
            });
            showToast("D√≠vida atualizada!", 'success');
          }
        } else {
          // Nova d√≠vida
          const novaDivida = {
            id: Date.now().toString(),
            nome, valor, telefone, categoria,
            status: "pendente",
            data, prazo: prazo || null,
            observacoes,
            criadoEm: new Date().toISOString(),
            atrasada: false
          };
          dividas.push(novaDivida);
          showToast(`${nome} registrado como devedor!`, 'success');
        }

        salvarDividas();
        fecharModal();
        document.getElementById('form-devedor').reset();
        definirDataAtual();
        editingId = null;
      } catch (error) {
        console.error('Erro ao salvar:', error);
        showToast("Erro ao salvar!", 'danger');
      } finally {
        btnSubmit.disabled = false;
        btnText.textContent = originalText;
      }
    }

    // Fun√ß√µes de a√ß√£o
    function marcarComoRecebido(id) {
      const divida = dividas.find(d => d.id === id);
      if (divida) {
        divida.status = 'pago';
        divida.atrasada = false;
        salvarDividas();
        showToast(`‚úÖ MT ${divida.valor.toFixed(2).replace('.', ',')} recebido de ${divida.nome}!`, 'success');
      }
    }

    function marcarComoPendente(id) {
      const divida = dividas.find(d => d.id === id);
      if (divida) {
        divida.status = 'pendente';
        salvarDividas();
        showToast(`D√≠vida de ${divida.nome} restaurada como pendente.`, 'warning');
      }
    }

    function editarDivida(id) {
      const divida = dividas.find(d => d.id === id);
      if (divida) {
        editingId = id;
        document.getElementById('modal-titulo').textContent = '‚úé Editar D√≠vida';
        document.getElementById('btn-text-adicionar').textContent = 'üíæ Salvar Altera√ß√µes';
        
        document.getElementById('input-nome').value = divida.nome;
        document.getElementById('input-valor').value = divida.valor;
        document.getElementById('input-telefone').value = divida.telefone || '';
        document.getElementById('input-categoria').value = divida.categoria || 'emprestimo';
        document.getElementById('input-data').value = divida.data || '';
        document.getElementById('input-prazo').value = divida.prazo || '';
        document.getElementById('input-observacoes').value = divida.observacoes || '';
        
        abrirModal('modal-divida');
      }
    }

    function abrirModalAdicionar() {
      editingId = null;
      document.getElementById('modal-titulo').textContent = '‚ûï Adicionar Nova D√≠vida';
      document.getElementById('btn-text-adicionar').textContent = '‚ûï Adicionar D√≠vida';
      document.getElementById('form-devedor').reset();
      definirDataAtual();
      abrirModal('modal-divida');
    }

    function removerDivida(id) {
      const divida = dividas.find(d => d.id === id);
      if (!divida) return;
      
      if (!confirm(`Remover d√≠vida de ${divida.nome}?`)) return;
      
      dividas = dividas.filter(d => d.id !== id);
      if (editingId === id) editingId = null;
      salvarDividas();
      showToast(`D√≠vida removida!`, 'success');
    }

    // Fun√ß√µes de cobran√ßa COM SMS
    function enviarCobranca(id) {
      const divida = dividas.find(d => d.id === id);
      if (!divida) return;

      let mensagem = `Ol√° ${divida.nome}, tudo bem?\n\n`;
      mensagem += `Lembrando que tens uma conta pendente:\n\n`;
      mensagem += `üíµ Valor: MT ${divida.valor.toFixed(2)}\n`;
      mensagem += `üìã Referente: ${getNomeCategoria(divida.categoria)}\n`;
      
      if (divida.data) {
        const dataFormatada = new Date(divida.data + 'T00:00:00').toLocaleDateString('pt-BR');
        mensagem += `üìÖ Data: ${dataFormatada}\n`;
      }
      
      if (divida.atrasada && divida.data && divida.prazo) {
        const dataDivida = new Date(divida.data);
        const dataVencimento = new Date(dataDivida);
        dataVencimento.setDate(dataVencimento.getDate() + parseInt(divida.prazo));
        const agora = new Date();
        const diasAtraso = Math.floor((agora - dataVencimento) / (1000 * 60 * 60 * 24));
        mensagem += `‚è∞ Atraso: ${diasAtraso} dia(s)\n`;
      }
      
      if (divida.observacoes) {
        mensagem += `üìù Detalhes: ${divida.observacoes}\n`;
      }
      
      mensagem += `\nPor favor, entre em contato para acertarmos.\nAgrade√ßo!`;

      window.mensagemCobrancaAtual = mensagem;
      window.dividaCobrancaAtual = divida;

      document.getElementById('modal-cobranca-titulo').textContent = `üìß Cobrar ${divida.nome}`;
      
      // HTML do modal de cobran√ßa com op√ß√£o de SMS
      document.getElementById('modal-cobranca-body').innerHTML = `
        <div style="margin-bottom: 1rem;">
          <p><strong>Devedor:</strong> ${divida.nome}</p>
          <p><strong>Telefone:</strong> ${divida.telefone || '<span style="color: #718096;">(n√£o cadastrado)</span>'}</p>
        </div>
        <div style="background: #f7fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
          <p><strong>Mensagem pronta:</strong></p>
          <textarea id="mensagem-cobranca" style="width: 100%; height: 150px; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-family: inherit; margin: 0.5rem 0; font-size: 0.875rem;">${mensagem}</textarea>
          <p style="font-size: 0.75rem; color: #718096;">Personalize se necess√°rio ‚Ä¢ ${mensagem.length} caracteres</p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem;">
          <button class="btn btn-info" onclick="copiarMensagemCobranca()">üìã Copiar</button>
          <button class="btn btn-success" onclick="enviarPorWhatsAppCobranca()" ${!divida.telefone ? 'disabled style="opacity:0.5"' : ''}>üì± WhatsApp</button>
          <button class="btn btn-primary" onclick="enviarPorSmsCobranca()" ${!divida.telefone ? 'disabled style="opacity:0.5"' : ''}>üì≤ SMS Direto</button>
          <button class="btn" onclick="enviarPorEmailCobranca()" style="background: #ed8936; color: white;">‚úâÔ∏è Email</button>
        </div>
        <div id="mensagem-copiada" style="display: none; color: #48bb78; font-size: 0.75rem; margin-top: 0.5rem;">
          ‚úì Mensagem copiada!
        </div>
        ${!divida.telefone ? '<p style="color: #f56565; font-size: 0.75rem; margin-top: 0.5rem;">‚ö†Ô∏è Cadastre um n√∫mero de telefone para enviar SMS/WhatsApp</p>' : ''}
      `;

      abrirModal('modal-cobranca');
    }

    function copiarMensagemCobranca() {
      const textarea = document.getElementById('mensagem-cobranca');
      textarea.select();
      navigator.clipboard.writeText(textarea.value).then(() => {
        const msg = document.getElementById('mensagem-copiada');
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', 2000);
        showToast("Mensagem copiada para a √°rea de transfer√™ncia!", 'success');
      }).catch(err => {
        console.error('Erro ao copiar:', err);
        showToast("Erro ao copiar mensagem", 'danger');
      });
    }

    function enviarPorWhatsAppCobranca() {
      const mensagem = encodeURIComponent(window.mensagemCobrancaAtual);
      window.open(`https://wa.me/?text=${mensagem}`, '_blank');
      showToast("Abrindo WhatsApp!", 'success');
      fecharModal();
    }

    function enviarPorEmailCobranca() {
      const divida = window.dividaCobrancaAtual;
      const assunto = encodeURIComponent(`Lembrete de Pagamento - ${divida.nome}`);
      const corpo = encodeURIComponent(window.mensagemCobrancaAtual);
      window.open(`mailto:?subject=${assunto}&body=${corpo}`, '_blank');
      showToast("Abrindo email!", 'success');
      fecharModal();
    }

    // NOVA FUN√á√ÉO: Enviar por SMS (requer API configurada)
    async function enviarPorSmsCobranca() {
      const divida = window.dividaCobrancaAtual;
      const mensagem = document.getElementById('mensagem-cobranca').value;
      
      if (!divida.telefone) {
        showToast(`N√∫mero de telefone n√£o cadastrado para ${divida.nome}.`, 'warning');
        return;
      }

      // SIMULA√á√ÉO - Para implementa√ß√£o real, precisa de API de SMS
      showToast(`üì≤ Preparando SMS para ${divida.nome}...`, 'info');
      
      // Aqui voc√™ implementaria a chamada √† API de SMS
      // Exemplo com fetch:
      /*
      try {
        const response = await fetch('SUA_API_DE_SMS_AQUI', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            to: divida.telefone,
            message: mensagem,
            apiKey: 'SUA_CHAVE_API'
          })
        });
        
        if (response.ok) {
          showToast(`‚úÖ SMS enviado para ${divida.nome}!`, 'success');
          fecharModal();
        } else {
          showToast(`Erro ao enviar SMS.`, 'danger');
        }
      } catch (error) {
        showToast(`Erro: ${error.message}`, 'danger');
      }
      */
      
      // Por enquanto, mostra op√ß√µes alternativas
      setTimeout(() => {
        const confirmar = confirm(`Para enviar SMS diretamente para ${divida.telefone}:\n\n1. Voc√™ precisa de uma API de SMS (Twilio, IAGENTEsms, etc.)\n2. Configure as credenciais no c√≥digo\n\nDeseja copiar a mensagem para enviar manualmente?`);
        if (confirmar) {
          copiarMensagemCobranca();
        }
      }, 500);
    }

    // Fun√ß√µes auxiliares
    function getNomeCategoria(codigo) {
      const categorias = {
        'emprestimo': 'üí∞ Empr√©stimo',
        'servico': 'üîß Servi√ßo',
        'venda': 'üõí Venda',
        'outro': 'üìù Outro'
      };
      return categorias[codigo] || 'üìù Outro';
    }

    function definirDataAtual() {
      const hoje = new Date().toISOString().split('T')[0];
      const inputData = document.getElementById('input-data');
      if (inputData && !inputData.value) {
        inputData.value = hoje;
      }
    }

    function filtrarDividas(filtro) {
      filtroAtual = filtro;
      atualizarListaDividas();
    }

    function mostrarNotificacoes() {
      // Verificar d√≠vidas atrasadas
      const agora = new Date();
      let notificacoesCount = 0;
      let notificacoesHTML = '';

      dividas.forEach(divida => {
        if (divida.status !== 'pago' && divida.data && divida.prazo) {
          const dataDivida = new Date(divida.data);
          const dataVencimento = new Date(dataDivida);
          dataVencimento.setDate(dataVencimento.getDate() + parseInt(divida.prazo));
          const diasAtraso = Math.floor((agora - dataVencimento) / (1000 * 60 * 60 * 24));
          
          if (diasAtraso > 0) {
            notificacoesCount++;
            notificacoesHTML += `
              <div style="background: #fff5f5; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #f56565;">
                <p style="margin: 0 0 0.25rem 0; font-weight: 600;">${divida.nome}</p>
                <p style="margin: 0 0 0.25rem 0; font-size: 0.875rem;">MT ${divida.valor.toFixed(2)} ‚Ä¢ ${diasAtraso} dia(s) atrasado</p>
                <button class="btn btn-small" onclick="enviarCobranca('${divida.id}'); fecharModal();" style="background: #f56565; color: white; padding: 0.25rem 0.5rem;">Cobrar Agora</button>
              </div>
            `;
          }
        }
      });

      document.getElementById('modal-notificacoes-body').innerHTML = notificacoesCount > 0 ? 
        `<h3 style="color: #2d3748; margin-top: 0;">${notificacoesCount} cobran√ßa(s) pendente(s)</h3>
         ${notificacoesHTML}` :
        `<div style="text-align: center; padding: 2rem 1rem;">
           <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
           <h3 style="color: #2d3748; margin: 0 0 0.5rem 0;">Tudo em dia!</h3>
           <p style="color: #718096;">Nenhuma d√≠vida atrasada no momento.</p>
         </div>`;

      // Atualizar badge
      const badge = document.getElementById('notificacao-badge');
      if (notificacoesCount > 0) {
        badge.textContent = notificacoesCount;
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }

      abrirModal('modal-notificacoes');
    }

    function abrirModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }

    function fecharModal() {
      document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = 'none';
      });
      document.body.style.overflow = 'auto';
      editingId = null;
    }

    function showToast(message, type = 'info') {
      // Remover toasts antigos
      document.querySelectorAll('.toast').forEach(toast => toast.remove());
      
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        if (toast.parentNode) {
          toast.style.opacity = '0';
          toast.style.transform = 'translateX(100%)';
          setTimeout(() => toast.remove(), 300);
        }
      }, 3000);
    }

    // Fechar modal ao clicar fora
    window.addEventListener('click', (event) => {
      if (event.target.classList.contains('modal')) {
        fecharModal();
      }
    });

    // Solicitar permiss√£o para notifica√ß√µes
    if ('Notification' in window && Notification.permission === 'default') {
      Notification.requestPermission();
    }

    // Teste inicial
    console.log('Sistema de D√≠vidas carregado com sucesso!');
  </script>
 </body>
</html>
